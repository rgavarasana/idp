<script src="~/js/oidc-client.min.js"></script>
<script>
    window.onload = function () {
        var signinBtn = document.getElementById("signinBtn"); 
        var signoutBtn = document.getElementById("signoutBtn"); 
        var apiBtn = document.getElementById("apiBtn"); 

        var config = {
            authority: "https://localhost:44363",
            client_id: "SPA",
            scope: "openid DemoApi profile",
            response_type: "id_token token",
            popup_redirect_uri: "https://localhost:44306/SignInCallback.html",
            popup_post_logout_redirect_uri: "https://localhost:44306/SignOutCallback.html"

        };

        var user;
        var mgr = new Oidc.UserManager(config);

        signinBtn.onclick = function () {
            mgr.signinPopup().then(function (x) {
                user = x;
                refreshButtons();
            })

        };

        apiBtn.onclick = function () {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://localhost:44301/api/user");
            if (user) {
                xhr.setRequestHeader("Authorization", "Bearer " + user.access_token);
            }

            xhr.onload = function () {
                if (xhr.status != 200) {
                    alert("Error calling Api");
                } else {
                    alert(xhr.responseText);
                }
            }
            xhr.send();

        };

        function refreshButtons() {
            signinBtn.className = user ? "hidden" : "visible";
            signoutBtn.className = user ? "visible" : "hidden";
        }

    }
</script>

<div class="jumbotron">
    <button id="signinBtn">Sign In</button>
    <button id="signoutBtn" class="hidden">Sign Out</button>
    <button id="apiBtn">Call Api</button>
</div>

